<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apply Mapping Functions in Frequent Saving â€¢ currr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Apply Mapping Functions in Frequent Saving">
<meta property="og:description" content="Implementations of the family of map() functions with frequent saving of the intermediate results. The contained functions let you start the evaluation of the iterations where you stopped  (reading the already evaluated ones from cache), and work with the currently evaluated iterations while remaining ones are running in a background job. Parallel computing is also easier with the workers parameter.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">currr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
<a href="https://marcellgranat.com" alt="Marcell Granat blog" class="external-link">
<img src="icon.png" alt="Marcell Granat blog" style="width: 20px; margin-left: -10px"/>
</a>
</li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
<a href="https://github.com/MarcellGranat/currr/" class="external-link">
<span class="fab fa-github fa-lg"></span>
</a>
</li>
</ul>
</div>
<!--/.nav-collapse -->
</div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="currr-">currr <img src="https://raw.githubusercontent.com/MarcellGranat/marcellgranat-website/main/static/currr/logo.png" align="right" width="120px"><a class="anchor" aria-label="anchor" href="#currr-"></a>
</h1></div>
<!-- badges: start -->

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<blockquote>
<p>A long journey is best broken into small steps, and the importance of taking a rest must never be underestimate.</p>
</blockquote>
<p>The <strong>currr</strong> package is a wrapper for the <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map()</a></code> family but extends the iteration process with a certain number of <strong>checkpoints</strong> (<code>currr</code> = <code>c</code>heckpoints + <code>purrr</code>), where the evaluated results are saved, and we can always restart from there.</p>
<p><img src="https://raw.githubusercontent.com/MarcellGranat/marcellgranat-website/main/static/currr/example.gif" align="center"></p>
<p>Implementations of the family of map() functions with a frequent saving of the intermediate results. The contained functions let you <strong>start</strong> the evaluation of the iterations <strong>where you stopped</strong> (reading the already evaluated ones from the cache), and <strong>work with the currently evaluated iterations</strong> while the remaining ones are running in a background job. <strong>Parallel</strong> computing is also easier with the <code>workers</code> parameter.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"currr"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>The following example uses <code>currr</code> to present an everyday issue: run a time-demanding iteration, but you want to rerun it again.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MarcellGranat/currr" class="external-link">currr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>currr.folder <span class="op">=</span> <span class="st">".currr"</span>, currr.wait <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="co"># folder in your wd, where to save cache data</span></span>
<span></span>
<span><span class="va">avg_n</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.data</span>, <span class="va">.col</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># meaningless function that takes about 1 sec</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">.data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span> <span class="va">.col</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="op">(</span>\<span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="checkpoints">Checkpoints<a class="anchor" aria-label="anchor" href="#checkpoints"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span>msg <span class="op">=</span> <span class="st">"First evaluation"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/cp_map.html">cp_map</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, .f <span class="op">=</span> <span class="va">avg_n</span>, .data <span class="op">=</span> <span class="va">iris</span>, </span>
<span>       .col <span class="op">=</span> <span class="va">Sepal.Length</span>, </span>
<span>       name <span class="op">=</span> <span class="st">"iris_mean"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 5.843333</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 11.68667</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 17.53</span></span>
<span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># ~ 1:50 =&gt; 50 x 1 sec</span></span>
<span><span class="co">#&gt; First evaluation: 50.351 sec elapsed</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span>msg <span class="op">=</span> <span class="st">"Second evaluation"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/cp_map.html">cp_map</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, .f <span class="op">=</span> <span class="va">avg_n</span>, .data <span class="op">=</span> <span class="va">iris</span>, </span>
<span>       .col <span class="op">=</span> <span class="va">Sepal.Length</span>, </span>
<span>       name <span class="op">=</span> <span class="st">"iris_mean"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; âœ“ Everything is unchanged. Reading cache.</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 5.843333</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 11.68667</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 17.53</span></span>
<span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># ~ 0 sec</span></span>
<span><span class="co">#&gt; Second evaluation: 0.034 sec elapsed</span></span></code></pre></div>
<p>If the <code>.x</code> input and <code>.f</code> are the same, then the 2nd time you call the function, it reads the outcome from the specified folder (<code>.currr</code>). Also if <code>.x</code> changes, but some of its part remain the same, then that part is taken from the previously saved results, and only the new elements of <code>.x</code> are called for evaluation. (If <code>.f</code> changes, then the process will start from zero.)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span>msg <span class="op">=</span> <span class="st">"Partly modification"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/cp_map.html">cp_map</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="fl">20</span><span class="op">:</span><span class="fl">60</span>, .f <span class="op">=</span> <span class="va">avg_n</span>, .data <span class="op">=</span> <span class="va">iris</span>, </span>
<span>       .col <span class="op">=</span> <span class="va">Sepal.Length</span>, </span>
<span>       name <span class="op">=</span> <span class="st">"iris_mean"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; âš  .x has changed. Looking for mathcing result to save them as cache</span></span>
<span><span class="co">#&gt; â—Œ Cache updated based on the new .x values</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 116.8667</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 122.71</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 128.5533</span></span>
<span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># ~ 50:60 =&gt; 10 x 1 sec</span></span>
<span><span class="co">#&gt; Partly modification: 10.378 sec elapsed</span></span></code></pre></div>
<p>You can remove the cache files, if you want to reset the process (or remove the already unnecessary files from your folder).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># only cache files for iris_mean</span></span>
<span><span class="fu"><a href="reference/remove_currr_cache.html">remove_currr_cache</a></span><span class="op">(</span><span class="st">"iris_mean"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># all cache files</span></span>
<span><span class="fu"><a href="reference/remove_currr_cache.html">remove_currr_cache</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parallel-process">Parallel process<a class="anchor" aria-label="anchor" href="#parallel-process"></a>
</h3>
<p>You can also use multicore process (built on the <code>parallel</code> package). After evaluation, the computation will automatically reset to sequential.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>currr.workers <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># &lt;</span></span>
<span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span>msg <span class="op">=</span> <span class="st">"Parallel computation"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/cp_map.html">cp_map</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, .f <span class="op">=</span> <span class="va">avg_n</span>, .data <span class="op">=</span> <span class="va">iris</span>, </span>
<span>       .col <span class="op">=</span> <span class="va">Sepal.Length</span>, </span>
<span>       name <span class="op">=</span> <span class="st">"iris_mean"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 5.843333</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 11.68667</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 17.53</span></span>
<span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># ~ 50 / 5 =&gt; 10 sec</span></span>
<span><span class="co">#&gt; Parallel computation: 21.159 sec elapsed</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="background-process">Background process<a class="anchor" aria-label="anchor" href="#background-process"></a>
</h3>
<p>This is another functionality that makes <code>currr</code> to be cool. Working in RStudio you can set the <code>wait</code> parameter to 0-1/1+, define how many iterations you want to wait, and then let R work on the remaining iterations in the background, while you can work with the evaluated ones. If wait &lt; 1, then it is interpreted as what proportion of the iterations you want to wait. Whenever you recall the function, it will return the already evaluated ones (use the <code>fill</code> parameter to specify whether you want to get <code>NULL</code>s to the pending ones.)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>currr.wait <span class="op">=</span> <span class="fl">20</span>, currr.fill <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://raw.githubusercontent.com/MarcellGranat/marcellgranat-website/main/static/currr/example2.gif" align="center"></p>
<p>In the example above, you get your results, when 20 iterations are evaluated, but the job in the background keeps running.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=currr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/MarcellGranat/currr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/MarcellGranat/currr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing currr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Marcell Granat <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-4036-1500" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=currr" class="external-link"><img src="https://www.r-pkg.org/badges/version/currr" alt="CRAN_Status_Badge"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Marcell Granat.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
