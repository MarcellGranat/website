<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Learn how to analyse, understand, and communicate about your data!">
<title>Big Data &amp; Data Visualisation - Tidy modeling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
<meta property="og:title" content="Big Data &amp; Data Visualisation - Tidy modeling">
<meta property="og:description" content="">
<meta property="og:image" content="https://marcellgranat.com/bigdata/files/social-image-s23.png">
<meta property="og:site-name" content="Big Data &amp; Data Visualisation">
<meta property="og:locale" content="en_US">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Big Data &amp; Data Visualisation</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../syllabus.html" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../content/index.html" rel="" target="">
 <span class="menu-text">Classes and readings</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assignment.html" rel="" target="">
 <span class="menu-text">Assignments</span></a>
  </li>  
</ul>
<div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#splitting-resamples" id="toc-splitting-resamples" class="nav-link active" data-scroll-target="#splitting-resamples">Splitting (resamples)</a></li>
  <li><a href="#preprocessing-recipes" id="toc-preprocessing-recipes" class="nav-link" data-scroll-target="#preprocessing-recipes">Preprocessing (recipes)</a></li>
  <li><a href="#the-model-parsnip" id="toc-the-model-parsnip" class="nav-link" data-scroll-target="#the-model-parsnip">The model (parsnip) ğŸ’ƒ</a></li>
  <li><a href="#the-workflow-workflows" id="toc-the-workflow-workflows" class="nav-link" data-scroll-target="#the-workflow-workflows">The workflow (workflows)</a></li>
  <li><a href="#tuning-tune" id="toc-tuning-tune" class="nav-link" data-scroll-target="#tuning-tune">Tuning (tune)</a></li>
  <li>
<a href="#training-fit" id="toc-training-fit" class="nav-link" data-scroll-target="#training-fit">Training (fit)</a>
  <ul class="collapse">
<li><a href="#variable-importance" id="toc-variable-importance" class="nav-link" data-scroll-target="#variable-importance">variable importance</a></li>
  </ul>
</li>
  <li><a href="#predicting-predict" id="toc-predicting-predict" class="nav-link" data-scroll-target="#predicting-predict">Predicting (predict)</a></li>
  <li><a href="#evaluating-yardstick" id="toc-evaluating-yardstick" class="nav-link" data-scroll-target="#evaluating-yardstick">Evaluating (yardstick)</a></li>
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification">Classification</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header"><h1 class="title display-7">Tidy modeling</h1>

<div class="date-block bg-class text-white p-2">
  <p class="date">Readings and class materials for Tuesday, November 14, 2023</p>
</div>
</header><p>In the previous chapter, we observed that a machine learning tool, regardless of the chosen model, is built upon a very similar recipe. Firstly, we provide it with data, on which certain transformations may be performed beforehand. Then, we train a model on a given dataset, varying the hyperparameters, and evaluate its predictions on another dataset. Subsequently, we either utilize the model to make predictions, preferably the best ones, or examine which variable proved to be the most important based on certain metrics (we consider which approach was employed most frequently or which one significantly improved the predictive capability of the model)</p>
<p>As the Tidyverse contains a collection of packages that are generally useful and frequently used for reading, cleaning, and visualizing data, the tidymodels is a package collection that includes important tools for modelling, when we focus on prediction.</p>
<p>The tidymodels packages are designed to work together, and they are built on top of the Tidyverse. The packages are designed to be modular, so that you can easily mix and match them to suit your needs.</p>
<p><a href="https://www.tidymodels.org/packages/" class="uri">https://www.tidymodels.org/packages/</a></p>
<p>Let us proceed step by stepâ€¦</p>
<section id="splitting-resamples" class="level2"><h2 class="anchored" data-anchor-id="splitting-resamples">Splitting (resamples)</h2>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">attrition</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">attrition</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,470
Columns: 31
$ Age                      &lt;int&gt; 41, 49, 37, 33, 27, 32, 59, 30, 38, 36, 35, 2â€¦
$ Attrition                &lt;fct&gt; Yes, No, Yes, No, No, No, No, No, No, No, No,â€¦
$ BusinessTravel           &lt;fct&gt; Travel_Rarely, Travel_Frequently, Travel_Rareâ€¦
$ DailyRate                &lt;int&gt; 1102, 279, 1373, 1392, 591, 1005, 1324, 1358,â€¦
$ Department               &lt;fct&gt; Sales, Research_Development, Research_Developâ€¦
$ DistanceFromHome         &lt;int&gt; 1, 8, 2, 3, 2, 2, 3, 24, 23, 27, 16, 15, 26, â€¦
$ Education                &lt;ord&gt; College, Below_College, College, Master, Beloâ€¦
$ EducationField           &lt;fct&gt; Life_Sciences, Life_Sciences, Other, Life_Sciâ€¦
$ EnvironmentSatisfaction  &lt;ord&gt; Medium, High, Very_High, Very_High, Low, Veryâ€¦
$ Gender                   &lt;fct&gt; Female, Male, Male, Female, Male, Male, Femalâ€¦
$ HourlyRate               &lt;int&gt; 94, 61, 92, 56, 40, 79, 81, 67, 44, 94, 84, 4â€¦
$ JobInvolvement           &lt;ord&gt; High, Medium, Medium, High, High, High, Very_â€¦
$ JobLevel                 &lt;int&gt; 2, 2, 1, 1, 1, 1, 1, 1, 3, 2, 1, 2, 1, 1, 1, â€¦
$ JobRole                  &lt;fct&gt; Sales_Executive, Research_Scientist, Laboratoâ€¦
$ JobSatisfaction          &lt;ord&gt; Very_High, Medium, High, High, Medium, Very_Hâ€¦
$ MaritalStatus            &lt;fct&gt; Single, Married, Single, Married, Married, Siâ€¦
$ MonthlyIncome            &lt;int&gt; 5993, 5130, 2090, 2909, 3468, 3068, 2670, 269â€¦
$ MonthlyRate              &lt;int&gt; 19479, 24907, 2396, 23159, 16632, 11864, 9964â€¦
$ NumCompaniesWorked       &lt;int&gt; 8, 1, 6, 1, 9, 0, 4, 1, 0, 6, 0, 0, 1, 0, 5, â€¦
$ OverTime                 &lt;fct&gt; Yes, No, Yes, Yes, No, No, Yes, No, No, No, Nâ€¦
$ PercentSalaryHike        &lt;int&gt; 11, 23, 15, 11, 12, 13, 20, 22, 21, 13, 13, 1â€¦
$ PerformanceRating        &lt;ord&gt; Excellent, Outstanding, Excellent, Excellent,â€¦
$ RelationshipSatisfaction &lt;ord&gt; Low, Very_High, Medium, High, Very_High, Highâ€¦
$ StockOptionLevel         &lt;int&gt; 0, 1, 0, 0, 1, 0, 3, 1, 0, 2, 1, 0, 1, 1, 0, â€¦
$ TotalWorkingYears        &lt;int&gt; 8, 10, 7, 8, 6, 8, 12, 1, 10, 17, 6, 10, 5, 3â€¦
$ TrainingTimesLastYear    &lt;int&gt; 0, 3, 3, 3, 3, 2, 3, 2, 2, 3, 5, 3, 1, 2, 4, â€¦
$ WorkLifeBalance          &lt;ord&gt; Bad, Better, Better, Better, Better, Good, Goâ€¦
$ YearsAtCompany           &lt;int&gt; 6, 10, 0, 8, 2, 7, 1, 1, 9, 7, 5, 9, 5, 2, 4,â€¦
$ YearsInCurrentRole       &lt;int&gt; 4, 7, 0, 7, 2, 7, 0, 0, 7, 7, 4, 5, 2, 2, 2, â€¦
$ YearsSinceLastPromotion  &lt;int&gt; 0, 1, 0, 3, 2, 3, 0, 0, 1, 7, 0, 0, 4, 1, 0, â€¦
$ YearsWithCurrManager     &lt;int&gt; 5, 7, 0, 0, 2, 6, 0, 0, 8, 7, 3, 8, 3, 2, 3, â€¦</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">attrition_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="fu">tibble</span><span class="op">(</span><span class="va">attrition</span><span class="op">)</span>, prop <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we have a cleaned dataset, we can split it into two parts. The first part is used for training the model, and the second part is used for testing the model. The initial_split() function performs this split. The prop argument specifies the proportion of the data that should be used for training. The default value is 0.75, which means that 75% of the data will be used for training and 25% for testing. This is fine in most cases. The initial_split() function returns a list containing two tibbles: the training data and the testing data.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">training</span><span class="op">(</span><span class="va">attrition_split</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,176 Ã— 31
     Age Attrition BusinessTravel    DailyRate Department       DistanceFromHome
   &lt;int&gt; &lt;fct&gt;     &lt;fct&gt;                 &lt;int&gt; &lt;fct&gt;                       &lt;int&gt;
 1    35 No        Travel_Rarely          1490 Research_Develoâ€¦               11
 2    52 No        Travel_Rarely           956 Research_Develoâ€¦                6
 3    38 No        Travel_Rarely          1380 Research_Develoâ€¦                9
 4    42 No        Travel_Rarely           319 Research_Develoâ€¦               24
 5    31 No        Non-Travel              979 Research_Develoâ€¦                1
 6    40 No        Travel_Rarely          1492 Research_Develoâ€¦               20
 7    47 Yes       Travel_Frequently      1093 Sales                           9
 8    50 No        Travel_Rarely          1046 Research_Develoâ€¦               10
 9    42 No        Travel_Rarely           933 Research_Develoâ€¦               29
10    54 No        Travel_Rarely           971 Research_Develoâ€¦                1
# â„¹ 1,166 more rows
# â„¹ 25 more variables: Education &lt;ord&gt;, EducationField &lt;fct&gt;,
#   EnvironmentSatisfaction &lt;ord&gt;, Gender &lt;fct&gt;, HourlyRate &lt;int&gt;,
#   JobInvolvement &lt;ord&gt;, JobLevel &lt;int&gt;, JobRole &lt;fct&gt;, JobSatisfaction &lt;ord&gt;,
#   MaritalStatus &lt;fct&gt;, MonthlyIncome &lt;int&gt;, MonthlyRate &lt;int&gt;,
#   NumCompaniesWorked &lt;int&gt;, OverTime &lt;fct&gt;, PercentSalaryHike &lt;int&gt;,
#   PerformanceRating &lt;ord&gt;, RelationshipSatisfaction &lt;ord&gt;, â€¦</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">testing</span><span class="op">(</span><span class="va">attrition_split</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 294 Ã— 31
     Age Attrition BusinessTravel    DailyRate Department       DistanceFromHome
   &lt;int&gt; &lt;fct&gt;     &lt;fct&gt;                 &lt;int&gt; &lt;fct&gt;                       &lt;int&gt;
 1    22 No        Non-Travel             1123 Research_Develoâ€¦               16
 2    30 No        Travel_Rarely           125 Research_Develoâ€¦                9
 3    39 Yes       Travel_Rarely           895 Sales                           5
 4    35 No        Travel_Rarely           890 Sales                           2
 5    28 Yes       Travel_Rarely          1434 Research_Develoâ€¦                5
 6    35 No        Non-Travel             1097 Research_Develoâ€¦               11
 7    50 No        Travel_Rarely           989 Research_Develoâ€¦                7
 8    55 No        Travel_Rarely           836 Research_Develoâ€¦                8
 9    35 No        Travel_Frequently       664 Research_Develoâ€¦                1
10    30 No        Travel_Rarely           288 Research_Develoâ€¦                2
# â„¹ 284 more rows
# â„¹ 25 more variables: Education &lt;ord&gt;, EducationField &lt;fct&gt;,
#   EnvironmentSatisfaction &lt;ord&gt;, Gender &lt;fct&gt;, HourlyRate &lt;int&gt;,
#   JobInvolvement &lt;ord&gt;, JobLevel &lt;int&gt;, JobRole &lt;fct&gt;, JobSatisfaction &lt;ord&gt;,
#   MaritalStatus &lt;fct&gt;, MonthlyIncome &lt;int&gt;, MonthlyRate &lt;int&gt;,
#   NumCompaniesWorked &lt;int&gt;, OverTime &lt;fct&gt;, PercentSalaryHike &lt;int&gt;,
#   PerformanceRating &lt;ord&gt;, RelationshipSatisfaction &lt;ord&gt;, â€¦</code></pre>
</div>
</div>
<p>In many cases, it is important that the data we use to train the model and evaluate it is similar according to certain criteria. For example, if significant differences are observed in salaries, it is important to separate the original data in such a way that the distribution of salaries is the same in the training and testing tables. This can be ensured using the strata argument.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">attrition_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="fu">tibble</span><span class="op">(</span><span class="va">attrition</span><span class="op">)</span>, prop <span class="op">=</span> <span class="fl">0.8</span>, strata <span class="op">=</span> <span class="st">"MonthlyIncome"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span><span class="va">MonthlyIncome</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>data<span class="op">=</span><span class="fu">training</span><span class="op">(</span><span class="va">attrition_split</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.3</span>, fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>data<span class="op">=</span><span class="fu">testing</span><span class="op">(</span><span class="va">attrition_split</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.3</span>, fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="16-conent_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Furthermore, we have observed that each model possesses different hyperparameters. In the case of decision trees, the complexity of the tree is determined, while for other models, the number of degree of freedom terms to be applied is considered. Every other model will also have its own set of hyperparameters. We are seeking the combination of hyperparameters that yields the best performance. Typically, this is not achieved by solely evaluating the modelâ€™s performance on the test data using the training data, but by further dividing the training data. One example of this is k-fold cross-validation. In the case of k-fold cross-validation, if we divide the data into 10 parts, the model is trained on 90% of the previously created training data, and evaluated on the remaining 10% for a given set of hyperparameters. Then, we reverse the process and evaluate on another 10%. This process is repeated k (10) times. The average of the results is then calculated. This is a very common method for evaluating models. The rsample package contains a function that performs this split. The vfold_cv() function performs this split. The number of folds is specified by the v argument. The default value is 10.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">attrition_vsplit</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="fu">tibble</span><span class="op">(</span><span class="va">attrition</span><span class="op">)</span>, v <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">attrition_vsplit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#  10-fold cross-validation 
# A tibble: 10 Ã— 2
   splits             id    
   &lt;list&gt;             &lt;chr&gt; 
 1 &lt;split [1323/147]&gt; Fold01
 2 &lt;split [1323/147]&gt; Fold02
 3 &lt;split [1323/147]&gt; Fold03
 4 &lt;split [1323/147]&gt; Fold04
 5 &lt;split [1323/147]&gt; Fold05
 6 &lt;split [1323/147]&gt; Fold06
 7 &lt;split [1323/147]&gt; Fold07
 8 &lt;split [1323/147]&gt; Fold08
 9 &lt;split [1323/147]&gt; Fold09
10 &lt;split [1323/147]&gt; Fold10</code></pre>
</div>
</div>
<p>The cross-validation procedure can be very complex at times, for example when we want to forecast time series and always need to separate the data from the past five years to examine how we would forecast the next year. This can be done using the rset_manual function. This procedure is called step-forward cross-validation, and you can see an example of it in the link below. We could also mention the example of predicting stock prices or any other economic variable.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="https://www.marcellgranat.com/posts/morgan/"><img src="https://www.marcellgranat.com/posts/morgan/wfcv.png" class="img-fluid figure-img"></a></p>
<figcaption class="figure-caption">Walk-forward cross-validation</figcaption></figure>
</div>
<p>If sample size is a consideration, it may be worth choosing bootstrapping instead of simple cross-validation, as in this case the measurements of the individual training and test sets will be identical, and then randomly divide the dataset, using random sampling, to collect the samples. This enables us to run the model a very large number of times, in a very large quantity, under a given parameter, while keeping the size constant.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">bootstraps</span><span class="op">(</span><span class="fu">training</span><span class="op">(</span><span class="va">attrition_split</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Bootstrap sampling 
# A tibble: 100 Ã— 2
   splits             id          
   &lt;list&gt;             &lt;chr&gt;       
 1 &lt;split [1174/422]&gt; Bootstrap001
 2 &lt;split [1174/432]&gt; Bootstrap002
 3 &lt;split [1174/432]&gt; Bootstrap003
 4 &lt;split [1174/394]&gt; Bootstrap004
 5 &lt;split [1174/430]&gt; Bootstrap005
 6 &lt;split [1174/435]&gt; Bootstrap006
 7 &lt;split [1174/432]&gt; Bootstrap007
 8 &lt;split [1174/430]&gt; Bootstrap008
 9 &lt;split [1174/448]&gt; Bootstrap009
10 &lt;split [1174/441]&gt; Bootstrap010
# â„¹ 90 more rows</code></pre>
</div>
</div>
</section><section id="preprocessing-recipes" class="level2"><h2 class="anchored" data-anchor-id="preprocessing-recipes">Preprocessing (recipes)</h2>
<p>After splitting the data, it is necessary to perform transformations for certain models. Such a transformation could be, for example, standardization or excluding variables that have very high correlation or variables that have zero variabilty. Letâ€™s assume, for example, that we have a training data in which only one type of value occurs in a certain variable. For instance, only males are present in the training data. Obviously, when we want to make predictions with this model, we will not be able to use this column. Therefore, it is necessary that during training, this column is excluded. We can imagine that we have hundreds of variables and we cannot ensure that we can always filter out these columns in the training data. For example, we run the model for each year.</p>
<p>The tidymodels package collection contains the recipe package that allows us to perform such transformations. The recipe package is designed to create a blueprint for a model. It is a collection of steps that will be performed on the data before the model is trained. The recipe package contains a number of functions that can be used to create a recipe. The recipe() function creates a recipe object. The step_*() functions add steps to the recipe. The prep() function prepares the recipe, and the bake() function applies the recipe to the data.</p>
<p>The recipe() function takes two arguments. The first argument is the formula that specifies the target variable and the explanatory variables. The second argument is the data frame that contains the data. The step_*() functions take the recipe object as the first argument and the name of the step as the second argument. The prep() function takes the recipe object as the first argument. The bake() function takes the recipe object as the first argument and the data frame as the second argument.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">attrition_vsplit</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">splits</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[2]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[3]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[4]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[5]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[6]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[7]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[8]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[9]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[10]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">attrition_recipe</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">MonthlyIncome</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">attrition</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_rm</span><span class="op">(</span><span class="va">RelationshipSatisfaction</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># should use this?</span></span>
<span>  <span class="fu">step_dummy</span><span class="op">(</span><span class="fu">all_nominal</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_corr</span><span class="op">(</span><span class="fu">all_numeric</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">attrition_recipe_preped</span> <span class="op">&lt;-</span> <span class="va">attrition_recipe</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">prep</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">attrition_vsplit</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">splits</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[2]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[3]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[4]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[5]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[6]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[7]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[8]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[9]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;

[[10]]
&lt;Analysis/Assess/Total&gt;
&lt;1323/147/1470&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">attrition_vsplit</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">splits</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">first</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">analysis</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,323 Ã— 31
     Age Attrition BusinessTravel    DailyRate Department       DistanceFromHome
   &lt;int&gt; &lt;fct&gt;     &lt;fct&gt;                 &lt;int&gt; &lt;fct&gt;                       &lt;int&gt;
 1    41 Yes       Travel_Rarely          1102 Sales                           1
 2    49 No        Travel_Frequently       279 Research_Develoâ€¦                8
 3    37 Yes       Travel_Rarely          1373 Research_Develoâ€¦                2
 4    33 No        Travel_Frequently      1392 Research_Develoâ€¦                3
 5    27 No        Travel_Rarely           591 Research_Develoâ€¦                2
 6    32 No        Travel_Frequently      1005 Research_Develoâ€¦                2
 7    59 No        Travel_Rarely          1324 Research_Develoâ€¦                3
 8    30 No        Travel_Rarely          1358 Research_Develoâ€¦               24
 9    38 No        Travel_Frequently       216 Research_Develoâ€¦               23
10    36 No        Travel_Rarely          1299 Research_Develoâ€¦               27
# â„¹ 1,313 more rows
# â„¹ 25 more variables: Education &lt;ord&gt;, EducationField &lt;fct&gt;,
#   EnvironmentSatisfaction &lt;ord&gt;, Gender &lt;fct&gt;, HourlyRate &lt;int&gt;,
#   JobInvolvement &lt;ord&gt;, JobLevel &lt;int&gt;, JobRole &lt;fct&gt;, JobSatisfaction &lt;ord&gt;,
#   MaritalStatus &lt;fct&gt;, MonthlyIncome &lt;int&gt;, MonthlyRate &lt;int&gt;,
#   NumCompaniesWorked &lt;int&gt;, OverTime &lt;fct&gt;, PercentSalaryHike &lt;int&gt;,
#   PerformanceRating &lt;ord&gt;, RelationshipSatisfaction &lt;ord&gt;, â€¦</code></pre>
</div>
</div>
<p>How would the analysis data look like after these preprocessing steps?</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">attrition_vsplit</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">splits</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">first</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">analysis</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">bake</span><span class="op">(</span>object <span class="op">=</span> <span class="va">attrition_recipe_preped</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,323 Ã— 53
     Age DailyRate DistanceFromHome HourlyRate MonthlyRate NumCompaniesWorked
   &lt;int&gt;     &lt;int&gt;            &lt;int&gt;      &lt;int&gt;       &lt;int&gt;              &lt;int&gt;
 1    41      1102                1         94       19479                  8
 2    49       279                8         61       24907                  1
 3    37      1373                2         92        2396                  6
 4    33      1392                3         56       23159                  1
 5    27       591                2         40       16632                  9
 6    32      1005                2         79       11864                  0
 7    59      1324                3         81        9964                  4
 8    30      1358               24         67       13335                  1
 9    38       216               23         44        8787                  0
10    36      1299               27         94       16577                  6
# â„¹ 1,313 more rows
# â„¹ 47 more variables: PercentSalaryHike &lt;int&gt;, StockOptionLevel &lt;int&gt;,
#   TotalWorkingYears &lt;int&gt;, TrainingTimesLastYear &lt;int&gt;, YearsAtCompany &lt;int&gt;,
#   YearsInCurrentRole &lt;int&gt;, YearsSinceLastPromotion &lt;int&gt;,
#   YearsWithCurrManager &lt;int&gt;, MonthlyIncome &lt;int&gt;, Attrition_Yes &lt;dbl&gt;,
#   BusinessTravel_Travel_Frequently &lt;dbl&gt;, BusinessTravel_Travel_Rarely &lt;dbl&gt;,
#   Department_Sales &lt;dbl&gt;, Education_1 &lt;dbl&gt;, Education_2 &lt;dbl&gt;, â€¦</code></pre>
</div>
</div>
<p>Now we have our data preprocessed. Here comes the algorithm ğŸ¥ğŸ¥ğŸ¥</p>
</section><section id="the-model-parsnip" class="level2"><h2 class="anchored" data-anchor-id="the-model-parsnip">The model (parsnip) ğŸ’ƒ</h2>
<p>The parsnip package is a wrapper for a number of different models. The parsnip package contains a number of functions that can be used to create a model. The original models are written by individual programmers into different packages, thus we need to specify that the implemented model should be the one from which package, and which model. For example, there are different algoritms for a linear model. It can be an OLS, a LASSO (from the glmnet package), or a bayesian regression (stan package).</p>
<p>In this example, the linear_reg() function creates a linear regression model. The set_engine() function sets the model engine. If needed then the set_mode() function sets the model mode (regression/classification).</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">linear_reg_lm_spec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">linear_reg</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">'lm'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">linear_reg_glmnet_spec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">linear_reg</span><span class="op">(</span>penalty <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, mixture <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">'glmnet'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">linear_reg_stan_spec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">linear_reg</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">'stan'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="the-workflow-workflows" class="level2"><h2 class="anchored" data-anchor-id="the-workflow-workflows">The workflow (workflows)</h2>
<p>The workflow is a combination of the recipe and a parsnip model specification. The workflow package contains a number of functions that can be used to create a workflow. The workflow() function creates a workflow object. The add_recipe() function adds a recipe to the workflow. The add_model() function adds a model to the workflow.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">linear_reg_glmnet_workflow</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">attrition_recipe</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">linear_reg_glmnet_spec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">linear_reg_glmnet_workflow</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>â•â• Workflow â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Preprocessor: Recipe
Model: linear_reg()

â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3 Recipe Steps

â€¢ step_rm()
â€¢ step_dummy()
â€¢ step_corr()

â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Linear Regression Model Specification (regression)

Main Arguments:
  penalty = tune()
  mixture = tune()

Computational engine: glmnet </code></pre>
</div>
</div>
</section><section id="tuning-tune" class="level2"><h2 class="anchored" data-anchor-id="tuning-tune">Tuning (tune)</h2>
<p>Okay, we have a workflow. Now we need to find the optimal parameters for the model. We can do this with the tune_grid() function. The tune_grid() function takes the workflow object as the first argument and the resamples object as the second argument. The tune_grid() function returns a tibble with the optimal parameters for each resample.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">attrition_glm_tn</span> <span class="op">&lt;-</span> <span class="fu">tune_grid</span><span class="op">(</span></span>
<span>  <span class="va">linear_reg_glmnet_workflow</span>,</span>
<span>  resamples <span class="op">=</span> <span class="va">attrition_vsplit</span>,</span>
<span>  grid <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">attrition_glm_tn</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Tuning results
# 10-fold cross-validation 
# A tibble: 10 Ã— 4
   splits             id     .metrics          .notes          
   &lt;list&gt;             &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;          
 1 &lt;split [1323/147]&gt; Fold01 &lt;tibble [60 Ã— 6]&gt; &lt;tibble [0 Ã— 3]&gt;
 2 &lt;split [1323/147]&gt; Fold02 &lt;tibble [60 Ã— 6]&gt; &lt;tibble [0 Ã— 3]&gt;
 3 &lt;split [1323/147]&gt; Fold03 &lt;tibble [60 Ã— 6]&gt; &lt;tibble [0 Ã— 3]&gt;
 4 &lt;split [1323/147]&gt; Fold04 &lt;tibble [60 Ã— 6]&gt; &lt;tibble [0 Ã— 3]&gt;
 5 &lt;split [1323/147]&gt; Fold05 &lt;tibble [60 Ã— 6]&gt; &lt;tibble [0 Ã— 3]&gt;
 6 &lt;split [1323/147]&gt; Fold06 &lt;tibble [60 Ã— 6]&gt; &lt;tibble [0 Ã— 3]&gt;
 7 &lt;split [1323/147]&gt; Fold07 &lt;tibble [60 Ã— 6]&gt; &lt;tibble [0 Ã— 3]&gt;
 8 &lt;split [1323/147]&gt; Fold08 &lt;tibble [60 Ã— 6]&gt; &lt;tibble [0 Ã— 3]&gt;
 9 &lt;split [1323/147]&gt; Fold09 &lt;tibble [60 Ã— 6]&gt; &lt;tibble [0 Ã— 3]&gt;
10 &lt;split [1323/147]&gt; Fold10 &lt;tibble [60 Ã— 6]&gt; &lt;tibble [0 Ã— 3]&gt;</code></pre>
</div>
</div>
<p>With the code above, we tried 30 different combination of the hyperparameters. The model is built on th analysis sets and assessed on the assessment sets.</p>
<p>We can show the best solutions:</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_best</span><span class="op">(</span><span class="va">attrition_glm_tn</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 8
   penalty mixture .metric .estimator  mean     n std_err .config              
     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
1 6.77e- 2   0.886 rmse    standard   1679.    10    30.4 Preprocessor1_Model27
2 1.21e-10   0.328 rmse    standard   1679.    10    30.3 Preprocessor1_Model09
3 1.36e- 8   0.393 rmse    standard   1679.    10    30.4 Preprocessor1_Model11
4 8.22e- 6   0.638 rmse    standard   1679.    10    30.4 Preprocessor1_Model19
5 1.77e- 2   0.655 rmse    standard   1679.    10    30.4 Preprocessor1_Model20</code></pre>
</div>
</div>
<p>Or based on <span class="math inline">\(R^2\)</span> (if you used strata, then probably the same solutions will be shown):</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_best</span><span class="op">(</span><span class="va">attrition_glm_tn</span>, n <span class="op">=</span> <span class="fl">5</span>, metric <span class="op">=</span> <span class="st">"rsq"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 8
     penalty mixture .metric .estimator  mean     n std_err .config             
       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 0.0677       0.886 rsq     standard   0.872    10 0.00918 Preprocessor1_Modelâ€¦
2 0.0271       0.762 rsq     standard   0.872    10 0.00918 Preprocessor1_Modelâ€¦
3 0.00000822   0.638 rsq     standard   0.872    10 0.00918 Preprocessor1_Modelâ€¦
4 0.00000143   0.694 rsq     standard   0.872    10 0.00918 Preprocessor1_Modelâ€¦
5 0.0177       0.655 rsq     standard   0.872    10 0.00918 Preprocessor1_Modelâ€¦</code></pre>
</div>
</div>
<p>Now, we can finalise the workflow, with our best performing hyperparameters:</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">linear_reg_glmnet_workflow_final</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">linear_reg_glmnet_workflow</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">finalize_workflow</span><span class="op">(</span></span>
<span>    <span class="fu">select_best</span><span class="op">(</span><span class="va">attrition_glm_tn</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">linear_reg_glmnet_workflow_final</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>â•â• Workflow â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Preprocessor: Recipe
Model: linear_reg()

â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3 Recipe Steps

â€¢ step_rm()
â€¢ step_dummy()
â€¢ step_corr()

â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Linear Regression Model Specification (regression)

Main Arguments:
  penalty = 0.0676505986084902
  mixture = 0.886128063788638

Computational engine: glmnet </code></pre>
</div>
</div>
</section><section id="training-fit" class="level2"><h2 class="anchored" data-anchor-id="training-fit">Training (fit)</h2>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">linear_reg_glmnet_fit</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">linear_reg_glmnet_workflow_final</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">fit</span><span class="op">(</span>data <span class="op">=</span> <span class="op">(</span><span class="fu">training</span><span class="op">(</span><span class="va">attrition_split</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="variable-importance" class="level3"><h3 class="anchored" data-anchor-id="variable-importance">variable importance</h3>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">linear_reg_glmnet_fit</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull_workflow_fit</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">vip</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vip/man/vi.html">vi</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 52 Ã— 3
   Variable                         Importance Sign 
   &lt;chr&gt;                                 &lt;dbl&gt; &lt;chr&gt;
 1 JobRole_Manager                       7637. POS  
 2 JobRole_Research_Director             7299. POS  
 3 JobRole_Research_Scientist            2929. NEG  
 4 JobRole_Laboratory_Technician         2888. NEG  
 5 JobRole_Sales_Representative          2538. NEG  
 6 JobRole_Human_Resources               2268. NEG  
 7 PerformanceRating_1                    744. NEG  
 8 JobRole_Sales_Executive                691. POS  
 9 Department_Sales                       557. NEG  
10 BusinessTravel_Travel_Frequently       323. POS  
# â„¹ 42 more rows</code></pre>
</div>
</div>
</section></section><section id="predicting-predict" class="level2"><h2 class="anchored" data-anchor-id="predicting-predict">Predicting (predict)</h2>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">linear_reg_glmnet_fit</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="fu">testing</span><span class="op">(</span><span class="va">attrition_split</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 296 Ã— 1
    .pred
    &lt;dbl&gt;
 1  3475.
 2  8100.
 3  1911.
 4 17107.
 5 15567.
 6  6193.
 7  7399.
 8  1721.
 9 17095.
10 14621.
# â„¹ 286 more rows</code></pre>
</div>
</div>
</section><section id="evaluating-yardstick" class="level2"><h2 class="anchored" data-anchor-id="evaluating-yardstick">Evaluating (yardstick)</h2>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">linear_reg_glmnet_fit</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="fu">testing</span><span class="op">(</span><span class="va">attrition_split</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">bind_cols</span><span class="op">(</span><span class="va">attrition_split</span> <span class="op">%&gt;%</span> <span class="fu">testing</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">yardstick</span><span class="fu">::</span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/rsq.html">rsq</a></span><span class="op">(</span>truth <span class="op">=</span> <span class="va">MonthlyIncome</span>, estimate <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rsq     standard       0.861</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">linear_reg_glmnet_fit</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="fu">testing</span><span class="op">(</span><span class="va">attrition_split</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">bind_cols</span><span class="op">(</span><span class="va">attrition_split</span> <span class="op">%&gt;%</span> <span class="fu">testing</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">yardstick</span><span class="fu">::</span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/metrics.html">metrics</a></span><span class="op">(</span>truth <span class="op">=</span> <span class="va">MonthlyIncome</span>, estimate <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard    1812.   
2 rsq     standard       0.861
3 mae     standard    1436.   </code></pre>
</div>
</div>
</section><section id="classification" class="level2"><h2 class="anchored" data-anchor-id="classification">Classification</h2>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rand_forest_randomForest_spec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">rand_forest</span><span class="op">(</span>mtry <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, min_n <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">'randomForest'</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">'classification'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">attrition_recipe</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">Attrition</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">attrition</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_rm</span><span class="op">(</span><span class="va">RelationshipSatisfaction</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_pca</span><span class="op">(</span><span class="fu">all_numeric</span><span class="op">(</span><span class="op">)</span>, threshold <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">step_corr</span><span class="op">(</span><span class="fu">all_numeric</span><span class="op">(</span><span class="op">)</span>, threshold <span class="op">=</span> <span class="fl">.6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rand_forest_randomForest_workflow</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">attrition_recipe</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">rand_forest_randomForest_spec</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">attrition_rf_tn</span> <span class="op">&lt;-</span> <span class="fu">tune_grid</span><span class="op">(</span></span>
<span>  <span class="va">rand_forest_randomForest_workflow</span>,</span>
<span>  resamples <span class="op">=</span> <span class="va">attrition_vsplit</span>,</span>
<span>  grid <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">show_best</span><span class="op">(</span><span class="va">attrition_rf_tn</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 8
   mtry min_n .metric .estimator  mean     n std_err .config             
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1     2    27 roc_auc binary     0.787    10  0.0119 Preprocessor1_Model1
2     4    10 roc_auc binary     0.784    10  0.0134 Preprocessor1_Model3
3    13    23 roc_auc binary     0.778    10  0.0116 Preprocessor1_Model2
4    10     4 roc_auc binary     0.775    10  0.0112 Preprocessor1_Model4
5     8    35 roc_auc binary     0.775    10  0.0107 Preprocessor1_Model5</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rf_workflow_final</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">rand_forest_randomForest_workflow</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">finalize_workflow</span><span class="op">(</span></span>
<span>    <span class="fu">select_best</span><span class="op">(</span><span class="va">attrition_rf_tn</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># roc curve</span></span>
<span></span>
<span><span class="va">rf_workflow_final</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">fit</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">training</span><span class="op">(</span><span class="va">attrition_split</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="fu">testing</span><span class="op">(</span><span class="va">attrition_split</span><span class="op">)</span>, type<span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">bind_cols</span><span class="op">(</span><span class="va">attrition_split</span> <span class="op">%&gt;%</span> <span class="fu">testing</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">yardstick</span><span class="fu">::</span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_curve.html">roc_curve</a></span><span class="op">(</span>truth <span class="op">=</span> <span class="va">Attrition</span>, <span class="va">.pred_Yes</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">autoplot</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="16-conent_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Content <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2023 by <a href="https://www.marcellgranat.com">Marcell GranÃ¡t</a> <br> All content licensed under a <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> <i class="fa-brands fa-creative-commons-nc" aria-label="creative-commons-nc"></i> <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>